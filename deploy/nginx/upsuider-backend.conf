# Reverse proxy: :80 -> http://127.0.0.1:4000

# Optional: map for proper WebSocket Upgrade handling
map $http_upgrade $connection_upgrade {
  default upgrade;
  ''      close;
}

server {
  listen 443;
  listen [::]:443;
  # Replace with your domain if you have one, e.g. example.com
  server_name zklogin.wiimdy.kr;

  # Optional: adjust if you expect larger requests
  client_max_body_size 10m;

  location /health {
    # Pass through health checks without extra headers if you prefer
    proxy_pass http://127.0.0.1:4000/health;
  }

  location / {
    proxy_pass http://127.0.0.1:4000;
    proxy_http_version 1.1;

    # Preserve client/proxy info
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # WebSocket support
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $connection_upgrade;

    # Timeouts (tweak as needed)
    proxy_read_timeout 75s;
    proxy_send_timeout 75s;
  }
}

